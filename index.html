<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Emoji Invaders</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      background: black;
      font-family: Arial, sans-serif;
      color: white;
      overflow: hidden;
    }
    canvas {
      display: block;
      margin: 0 auto;
      background: #111;
      border: 2px solid white;
    }
    #ui, #homeScreen, #shopScreen {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
    }
    .hidden { display: none; }
    button {
      padding: 12px 24px;
      margin: 10px;
      font-size: 18px;
      background: #333;
      color: white;
      border: 2px solid white;
      cursor: pointer;
    }
    button:hover { background: #444; }
    .shop-section {
      margin-bottom: 20px;
    }
    .shop-buttons {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
    }
    .shop-button {
      padding: 10px;
      font-size: 16px;
      border: 2px solid white;
      background: #222;
      color: white;
      cursor: pointer;
      min-width: 100px;
    }
    .shop-button.selected {
      border: 2px solid yellow;
    }
  </style>
</head>
<body>

<canvas id="gameCanvas" width="600" height="600"></canvas>

<div id="homeScreen">
  <h1>Emoji Invaders</h1>
  <button onclick="startGame()">‚ñ∂ Play</button>
  <button onclick="showShop()">üõçÔ∏è Shop</button>
</div>

<div id="shopScreen" class="hidden">
  <h2>Shop</h2>
  <p>Coins: <span id="coinCount">0</span> üü°</p>

  <div class="shop-section">
    <h3>Bullet Skins</h3>
    <div id="bulletShop" class="shop-buttons"></div>
  </div>

  <div class="shop-section">
    <h3>Player Skins</h3>
    <div id="playerShop" class="shop-buttons"></div>
  </div>

  <button onclick="hideShop()">‚¨Ö Back</button>
</div>

<div id="ui" class="hidden">
  <p>Score: <span id="score">0</span> | High Score: <span id="highScore">0</span></p>
</div>

<script>
// üéÆ SETTINGS
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const ui = document.getElementById('ui');
const homeScreen = document.getElementById('homeScreen');
const shopScreen = document.getElementById('shopScreen');
const scoreEl = document.getElementById('score');
const highScoreEl = document.getElementById('highScore');
const coinCountEl = document.getElementById('coinCount');

const bulletSkins = [
  { symbol: '.', color: 'white', price: 0 },
  { symbol: '.', color: 'blue', price: 10 },
  { symbol: '.', color: 'red', price: 10 },
  { symbol: '.', color: 'purple', price: 25 },
  { symbol: '.', color: 'green', price: 50 }
];
const playerSkins = [
  { emoji: 'üòÄ', price: 0 },
  { emoji: 'ü§Ø', price: 25 },
  { emoji: 'ü´•', price: 50 },
  { emoji: 'üëΩ', price: 75 }
];

let keys = {};
let bullets = [], enemies = [], enemyBullets = [], coins = [];
let player = { x: 300, y: 550 };
let score = 0, highScore = 0, coinsCollected = 0;
let canShoot = true;
let selectedBullet = 0, selectedPlayer = 0;
let ownedBullets = [0], ownedPlayers = [0];
let gameRunning = false;

// üì¶ STORAGE
function save() {
  localStorage.setItem('highScore', highScore);
  localStorage.setItem('coins', coinsCollected);
  localStorage.setItem('ownedBullets', JSON.stringify(ownedBullets));
  localStorage.setItem('ownedPlayers', JSON.stringify(ownedPlayers));
  localStorage.setItem('selectedBullet', selectedBullet);
  localStorage.setItem('selectedPlayer', selectedPlayer);
}
function load() {
  highScore = +localStorage.getItem('highScore') || 0;
  coinsCollected = +localStorage.getItem('coins') || 0;
  ownedBullets = JSON.parse(localStorage.getItem('ownedBullets')) || [0];
  ownedPlayers = JSON.parse(localStorage.getItem('ownedPlayers')) || [0];
  selectedBullet = +localStorage.getItem('selectedBullet') || 0;
  selectedPlayer = +localStorage.getItem('selectedPlayer') || 0;
}

// üïπÔ∏è GAME LOOP
function update() {
  if (!gameRunning) return;

  if (keys['ArrowLeft']) player.x -= 5;
  if (keys['ArrowRight']) player.x += 5;
  player.x = Math.max(0, Math.min(canvas.width - 30, player.x));

  bullets.forEach(b => b.y -= 5);
  bullets = bullets.filter(b => b.y > 0);

  enemyBullets.forEach(b => b.y += 3);
  enemyBullets = enemyBullets.filter(b => b.y < canvas.height);

  enemies.forEach(e => {
    if (Math.random() < 0.01) {
      enemyBullets.push({ x: e.x + 10, y: e.y + 10 });
    }
  });

  coins.forEach((coin, ci) => {
    bullets.forEach((b, bi) => {
      if (Math.abs(b.x - coin.x) < 20 && Math.abs(b.y - coin.y) < 20) {
        coins.splice(ci, 1);
        bullets.splice(bi, 1);
        coinsCollected++;
        coinCountEl.textContent = coinsCollected;
        save();
      }
    });
  });

  enemies.forEach((e, ei) => {
    bullets.forEach((b, bi) => {
      if (Math.abs(b.x - e.x) < 25 && Math.abs(b.y - e.y) < 25) {
        enemies.splice(ei, 1);
        bullets.splice(bi, 1);
        score++;
        scoreEl.textContent = score;
      }
    });
  });

  enemyBullets.forEach(b => {
    if (Math.abs(b.x - player.x) < 20 && Math.abs(b.y - player.y) < 20) {
      endGame();
    }
  });

  enemies.forEach(e => {
    if (Math.abs(e.y - player.y) < 20) {
      endGame();
    }
  });

  render();
  requestAnimationFrame(update);
}

// ‚úèÔ∏è DRAW
function render() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // Player
  ctx.font = '30px Arial';
  ctx.fillText(playerSkins[selectedPlayer].emoji, player.x, player.y);

  // Enemies
  enemies.forEach(e => ctx.fillText('üëæ', e.x, e.y));

  // Bullets
  bullets.forEach(b => {
    ctx.fillStyle = bulletSkins[selectedBullet].color;
    ctx.fillText(b.symbol, b.x, b.y);
  });

  // Enemy bullets
  ctx.fillStyle = 'red';
  enemyBullets.forEach(b => ctx.fillText('|', b.x, b.y));

  // Coins
  coins.forEach(c => {
    ctx.fillStyle = 'yellow';
    ctx.fillText('üü°', c.x, c.y);
  });
}

// üî´ SHOOT
function shoot() {
  if (!canShoot) return;
  canShoot = false;
  bullets.push({ x: player.x + 10, y: player.y, symbol: bulletSkins[selectedBullet].symbol });
  setTimeout(() => canShoot = true, 300);
}

// üéØ START / END GAME
function startGame() {
  score = 0;
  player.x = 300;
  bullets = [];
  enemies = [];
  enemyBullets = [];
  coins = [];
  gameRunning = true;
  ui.classList.remove('hidden');
  homeScreen.classList.add('hidden');
  scoreEl.textContent = 0;
  highScoreEl.textContent = highScore;

  spawnEnemy();
  spawnCoin();
  update();
}

function endGame() {
  gameRunning = false;
  ui.classList.add('hidden');
  homeScreen.classList.remove('hidden');
  if (score > highScore) {
    highScore = score;
    save();
  }
  alert(`Game Over! Score: ${score} | High Score: ${highScore}`);
}

function spawnEnemy() {
  if (!gameRunning) return;
  enemies.push({ x: Math.random() * 570, y: 30 });
  setTimeout(spawnEnemy, 1000);
}

function spawnCoin() {
  if (!gameRunning) return;
  coins.push({ x: Math.random() * 570, y: Math.random() * 400 + 50 });
  setTimeout(spawnCoin, 5000);
}

// üõçÔ∏è SHOP
function showShop() {
  shopScreen.classList.remove('hidden');
  homeScreen.classList.add('hidden');
  drawShop();
}

function hideShop() {
  shopScreen.classList.add('hidden');
  homeScreen.classList.remove('hidden');
}

function drawShop() {
  coinCountEl.textContent = coinsCollected;
  const bulletDiv = document.getElementById('bulletShop');
  const playerDiv = document.getElementById('playerShop');
  bulletDiv.innerHTML = '';
  playerDiv.innerHTML = '';

  bulletSkins.forEach((skin, i) => {
    const btn = document.createElement('button');
    btn.className = 'shop-button';
    btn.textContent = `${skin.color}`;
    if (selectedBullet === i) btn.classList.add('selected');
    if (!ownedBullets.includes(i) && skin.price > 0) {
      btn.textContent += ` - ${skin.price} üü°`;
      btn.onclick = () => {
        if (coinsCollected >= skin.price) {
          coinsCollected -= skin.price;
          ownedBullets.push(i);
          selectedBullet = i;
          save();
          drawShop();
        }
      };
    } else {
      btn.onclick = () => { selectedBullet = i; save(); drawShop(); };
    }
    bulletDiv.appendChild(btn);
  });

  playerSkins.forEach((skin, i) => {
    const btn = document.createElement('button');
    btn.className = 'shop-button';
    btn.textContent = `${skin.emoji}`;
    if (selectedPlayer === i) btn.classList.add('selected');
    if (!ownedPlayers.includes(i) && skin.price > 0) {
      btn.textContent += ` - ${skin.price} üü°`;
      btn.onclick = () => {
        if (coinsCollected >= skin.price) {
          coinsCollected -= skin.price;
          ownedPlayers.push(i);
          selectedPlayer = i;
          save();
          drawShop();
        }
      };
    } else {
      btn.onclick = () => { selectedPlayer = i; save(); drawShop(); };
    }
    playerDiv.appendChild(btn);
  });
}

// üîë INPUT
document.addEventListener('keydown', e => {
  keys[e.key] = true;
  if (e.key === ' ') shoot();
});
document.addEventListener('keyup', e => {
  keys[e.key] = false;
});

// üöÄ START
load();
drawShop();
</script>
</body>
</html>
